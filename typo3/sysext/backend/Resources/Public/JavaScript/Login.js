/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery","bootstrap","TYPO3/CMS/Backend/Input/Clearable"],function(o,i,e){"use strict";return new class{constructor(){this.showLoginProcess=(()=>{this.showLoadingIndicator(),e(this.options.error).addClass("hidden"),e(this.options.errorNoCookies).addClass("hidden")}),this.showLoadingIndicator=(()=>{e(this.options.submitButton).button("loading")}),this.handleSubmit=(o=>{this.showLoginProcess(),"function"==typeof this.options.submitHandler&&this.options.submitHandler(o)}),this.interfaceSelectorChanged=(()=>{const o=new Date,i=new Date(o.getTime()+31536e6);document.cookie="typo3-login-interface="+e(this.options.interfaceField).val()+"; expires="+i.toUTCString()+";"}),this.checkForInterfaceCookie=(()=>{if(e(this.options.interfaceField).length){const o=document.cookie.indexOf("typo3-login-interface=");if(-1!==o){let i=document.cookie.substr(o+22);i=i.substr(0,i.indexOf(";")),e(this.options.interfaceField).val(i)}}}),this.showCookieWarning=(()=>{e(this.options.formFields).addClass("hidden"),e(this.options.errorNoCookies).removeClass("hidden")}),this.hideCookieWarning=(()=>{e(this.options.formFields).removeClass("hidden"),e(this.options.errorNoCookies).addClass("hidden")}),this.checkCookieSupport=(()=>{const o=navigator.cookieEnabled;!1===o?this.showCookieWarning():document.cookie||null!==o||(document.cookie="typo3-login-cookiecheck=1",document.cookie?document.cookie="typo3-login-cookiecheck=; expires="+new Date(0).toUTCString():this.showCookieWarning())}),this.initializeEvents=(()=>{e(document).ajaxStart(this.showLoadingIndicator),e(this.options.loginForm).on("submit",this.handleSubmit),e(this.options.interfaceField).length>0&&e(document).on("change blur",this.options.interfaceField,this.interfaceSelectorChanged),document.querySelectorAll(".t3js-clearable").forEach(o=>o.clearable()),e(".t3js-login-news-carousel").on("slide.bs.carousel",o=>{const i=e(o.relatedTarget).height();e(o.target).find("div.active").parent().animate({height:i},500)})}),this.options={error:".t3js-login-error",errorNoCookies:".t3js-login-error-nocookies",formFields:".t3js-login-formfields",interfaceField:".t3js-login-interface-field",loginForm:"#typo3-login-form",submitButton:".t3js-login-submit",submitHandler:null,useridentField:".t3js-login-userident-field"},this.checkCookieSupport(),this.checkForInterfaceCookie(),this.initializeEvents(),top.location.href!==location.href&&(top.location.href=location.href)}}});